{% extends 'base.html' %}

{% block title %}Result - Product Query App{% endblock %}

{% block scripts %}
<link rel="stylesheet" href="{{ url_for('static', filename='styles/result.css') }}">
{% endblock %}
{% block content %}
<section>
    <h2>{{ translations['query_result'] }}</h2>
    <p><strong>{{ translations['your_query'] }}</strong> {{ query }}</p>
    <h3>{{ translations['products'] }}</h3>
    {# TODO: implement translations #}
    {# TODO: implement filter #}
    <div>
        <h5 id="filter-h5">
            <div>
                <button id="filter-button" class="details-toggle">Фильтры</button>
                <dialog id="filter-dialog">
                  <div id="dialog-inner-wrapper-div">
                    <form method="dialog" class="container">
                        <div id="filter-pricerange-div" class="container-md">
                          <span>От: <input type="number" placeholder="{{ products | map(attribute = 'price') | min }}"></span>
                          <span>До: <input type="number" placeholder="{{ products | map(attribute = 'price') | max }}"></span>
                          <input id="filter-slider-input" type="range">
                        </div>
                        <button type="submit" class="">Применить</button>
                    </form>
                  </div>
                </dialog>
                <button id="voice-filter-button" class="details-toggle">Голосовой фильтр</button>
                <dialog id="voice-filter-dialog">
                    <form action="/api/text-voice-filter" method="post" id="text-voice-filter-form">
                        <input type="text" name="text-filter" id="text-filter-input" required>
                        <input type="submit">
                    </form>
                    {# <form action="/products-voice-filter" method="post" enctype="multipart/form-data">
                        <label for="mic-select-return">{{ translations['microphone'] }}:</label>
                        <select id="mic-select-return"></select>
                        <button type="button" id="start-record-btn-return" class="full-width-btn">{{ translations['start_recording'] }}</button>
                        <button type="button" id="stop-record-btn-return" class="full-width-btn" disabled style="display: none">Stop Recording</button>
                        <!-- Recording Animation -->
                        <div id="recording-animation" class="recording-animation d-none mb-2">
                            <div class="mic-icon">
                                <i class="fas fa-microphone-alt fa-2x"></i>
                            </div>
                            <div class="pulse"></div>
                        </div>
                    </form>
                    #}
                    {# 
                    <section class="voice-query-fullwidth">
                            <h2>{{ translations['search_voice'] }}</h2>
                            <!-- Updated form for /voice_input -->
                            <form id="voice-input-form" action="/voice_input" method="post" enctype="multipart/form-data" style="display: none">
                                <label for="mic-select-voice">{{ translations['microphone'] }}:</label>
                                <select id="mic-select-voice"></select>
                                <button type="button" id="start-record-btn-voice" class="full-width-btn">{{ translations['start_recording'] }}</button>
                                <button type="button" id="stop-record-btn-voice" class="full-width-btn" disabled>Stop Recording</button>
                            </form>

                            <!-- Updated form for /return_product -->
                            <form id="return-product-form" action="/return_product" method="post" enctype="multipart/form-data">
                                <label for="mic-select-return">{{ translations['microphone'] }}:</label>
                                <select id="mic-select-return"></select>
                                <button type="button" id="start-record-btn-return" class="full-width-btn">{{ translations['start_recording'] }}</button>
                                <button type="button" id="stop-record-btn-return" class="full-width-btn" disabled style="display: none">Stop Recording</button>
                                <!-- Recording Animation -->
                                <div id="recording-animation" class="recording-animation d-none mb-2">
                                    <div class="mic-icon">
                                        <i class="fas fa-microphone-alt fa-2x"></i>
                                    </div>
                                    <div class="pulse"></div>
                                </div>
                            </form>
                    </section>
                    #}
                </dialog>
            </div>
        </h5>
    </div> 
    {% if products and products|length > 0 %}
        <div class="products-grid" id="products-container">
            {% for product in products %}
                <div class="product-item">
                    <div class="product-image">
                        {% if product.image %}
                            <img src="{{ url_for('static', filename='uploads/' + product['image']) }}" alt="{{ product['name'] }}" style="max-width: 150px;">
                        {% endif %}
                    </div>
                    <h4>{{ product['name'] }}</h4>
                    <p>{{ translations['price'] }} ₸ {{ product['price'] }}</p>
                    <p>{{ translations['category'] }}: {{ product['category'] }}</p>
                    <button class="details-toggle" product-id="{{ product['id'] }}" >{{ translations['more_info'] }}</button>
                    <div id="product-details-{{ product['id'] }}" class="product-details" style="display: none;">
                        <p id="additional-info-{{ product['id'] }}"></p>
                    </div>
                </div>
            {% endfor %}
        </div>
    {% else %}
        <p>{{ translations['no_products_found'] }}</p>
    {% endif %}
    <a href="{{ url_for('index') }}">{{ translations['go_back_home'] }}</a>
</section>

<script defer src="{{ url_for('static', filename='scripts/minified/result.min.js') }}"></script>
{% endblock %}
