<!-- CSRF Token Meta Tag -->
<meta name="csrf-token" content="{{ csrf_token }}">

<!-- Outer container (styled like a card but without extra margins) -->
<div class="card chat-card" style="margin: 0; border-radius: 12px; overflow: hidden;">
    <!-- Header -->
    <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center" style="border-radius: 0;">
        <h5 class="mb-0" style="font-size: 1rem;">{{ translations['chat_title'] }}</h5>
        <div class="d-flex align-items-center">
            <label for="mic-select-chat" class="mb-0 mr-2" style="font-size: 0.8rem;">
                {{ translations['microphone_label'] }}
            </label>
            <select id="mic-select-chat" class="form-control form-control-sm" style="width: auto;"></select>
        </div>
    </div>

    <!-- Body -->
    <div class="card-body d-flex flex-column" style="padding: 10px; height: 100%;">

        <!-- Chat Box -->
        <div id="chat-box" class="mb-3" style="height: 400px; overflow-y: auto;">
            {% for message in chat_history %}
                <div class="d-flex {{ 'justify-content-end' if message.role == 'user' else 'justify-content-start' }}">
                    <div class="chat-bubble p-2 mb-2 {{ 'bg-primary text-white' if message.role == 'user' else 'bg-light text-dark' }}" style="border-radius: 10px; max-width: 70%;">
                        <small><strong>{{ message.role | capitalize }}</strong></small><br>
                        <p>{{ message.content }}</p>
                        <small class="text-muted">{{ message.timestamp }}</small>
                    </div>
                </div>
            {% endfor %}
        </div>
        
        <!-- Recording Animation -->
        <div id="recording-animation" class="recording-animation d-none mb-2">
            <div class="mic-icon">
                <i class="fas fa-microphone-alt fa-2x"></i>
            </div>
            <div class="pulse"></div>
        </div>

        <!-- Bot Thinking Indicator -->
        <div id="bot-thinking" class="bot-thinking d-none mb-2">
            <div class="bot-thinking-dots">
                <span></span><span></span><span></span>
            </div>
        </div>

        <!-- Input Row -->
        <div class="input-group mb-2">
            <textarea id="user-input" class="form-control" rows="2" 
                      placeholder="{{ translations['user_input_placeholder'] }}"></textarea>
            <div class="input-group-append">
                <button id="send-text-btn" class="btn btn-primary">
                    {{ translations['send_button'] }}
                </button>
            </div>
        </div>

        <!-- Voice Buttons -->
        <div class="input-group">
            <button id="record-voice-btn" class="btn btn-secondary" disabled>
                {{ translations['record_voice_button'] }}
            </button>
            <button id="stop-record-voice-btn" class="btn btn-danger d-none">
                {{ translations['stop_recording_button'] }}
            </button>
        </div>
    </div>
</div>

<!-- Font Awesome for Microphone Icon -->

<!-- 
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
-->

<!-- Socket.io and jQuery -->
<!-- 
-->

<!-- Inline CSS for Chat Styles -->
<style>
    /* Bot Thinking Dots Animation */
    .bot-thinking-dots {
        display: flex;
        align-items: center;
        justify-content: center;
    }
    .bot-thinking-dots span {
        display: block;
        width: 8px;
        height: 8px;
        margin: 0 3px;
        background-color: #555;
        border-radius: 50%;
        animation: bot-thinking 1.4s infinite ease-in-out both;
    }
    .bot-thinking-dots span:nth-child(1) {
        animation-delay: -0.32s;
    }
    .bot-thinking-dots span:nth-child(2) {
        animation-delay: -0.16s;
    }
    @keyframes bot-thinking {
        0%, 80%, 100% {
            transform: scale(0);
        }
        40% {
            transform: scale(1);
        }
    }

    /* Recording Animation Styles */
    .recording-animation {
        display: flex;
        align-items: center;
        justify-content: center;
        color: red;
    }
    .mic-icon {
        margin-right: 10px;
        animation: pulse 1s infinite;
    }
    .pulse {
        width: 10px;
        height: 10px;
        background-color: red;
        border-radius: 50%;
        animation: pulse 1s infinite;
    }
    @keyframes pulse {
        0% {
            transform: scale(0.8);
            opacity: 1;
        }
        100% {
            transform: scale(1.4);
            opacity: 0;
        }
    }

    /* Utility Class to Hide Elements */
    .d-none {
        display: none !important;
    }

    /* Optional tweak for smaller chat text */
    .chat-bubble p {
        margin-bottom: 0.4rem;
    }
</style>


	<!-- Main Chat Logic (same as before) -->
<script defer src="{{ url_for('static', filename='scripts/minified/chat.min.js') }}"></script>
