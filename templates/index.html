{% extends 'base.html' %}

{% block title %}{{ translations['welcome'] }}{% endblock %}


{% block scripts %}
<script defer  src="{{ url_for('static', filename='scripts/socket.io.min.js') }}"></script>
<script defer src="{{ url_for('static', filename='scripts/jquery-3.6.0.min.js') }}"></script>
<script defer src="{{ url_for('static', filename='scripts/index.min.js') }}"></script>
<script defer src="{{ url_for('static', filename='scripts/chat_block.min.js') }}"></script>
{% endblock %}

{% block content %}
<link rel="stylesheet" href="{{ url_for('static', filename='styles/all.min.css') }}"/>



<main>
    <!-- Video Overlay -->
    <div id="video-overlay">
        <button id="close-video-btn">&times;</button>
        <video id="idle-video" src="/static/video/a.mp4" autoplay muted loop></video>
    </div>

    <!-- Voice Query Full Width -->
    <section class="voice-query-fullwidth">
        <h2>{{ translations['search_voice'] }}</h2>
        <!-- Updated form for /voice_input -->
        <form id="voice-input-form" action="/voice_input" method="post" enctype="multipart/form-data" style="display: none">
            <label for="mic-select-voice">{{ translations['microphone'] }}:</label>
            <select id="mic-select-voice"></select>
            <button type="button" id="start-record-btn-voice" class="full-width-btn">{{ translations['start_recording'] }}</button>
            <button type="button" id="stop-record-btn-voice" class="full-width-btn" disabled>Stop Recording</button>
        </form>

        <!-- Updated form for /return_product -->
        <form id="return-product-form" action="/return_product" method="post" enctype="multipart/form-data">
            <label for="mic-select-return">{{ translations['microphone'] }}:</label>
            <select id="mic-select-return"></select>
            <button type="button" id="start-record-btn-return" class="full-width-btn">{{ translations['start_recording'] }}</button>
            <button type="button" id="stop-record-btn-return" class="full-width-btn" disabled style="display: none">Stop Recording</button>
            <!-- Recording Animation -->
            <div id="recording-animation" class="recording-animation d-none mb-2">
                <div class="mic-icon">
                    <i class="fas fa-microphone-alt fa-2x"></i>
                </div>
                <div class="pulse"></div>
            </div>
        </form>
    </section>
    <!-- Button to Open Search Sidebar -->
    <div class="open-search-btn-container">
        <button id="open-search-sidebar" class="btn-open-search">{{ translations['search'] }}</button>
    </div>

    <!-- Product List with Infinite Scrolling -->
    <section id="product-list">
        <h2>{{ translations['product_list'] }}</h2>
        <div id="products-container" class="products-grid">
            {% for product in products %}
                <div class="product-item">
                    <!-- Product Image -->
                    <div class="product-image">
                        <a href="/product/{{ product.id }}">
                            <img src="{{ product.image_url }}" alt="{{ product.name }}" />
                        </a>
                    </div>
    
                    <!-- More Info Button -->
                    <button class="details-toggle" onclick="toggleDetails(this)">
                        {{ translations['more_info'] }}
                    </button>
    
                    <!-- Product Details -->
                    <div class="product-details">
                        <button type="button" class="less-info-btn" onclick="closeDetails(this)">
                            {{ translations['less_info'] }}
                        </button>
                        <h3>
                            <a href="/product/{{ product.id }}">{{ product.name }}</a>
                        </h3>
                        <p>{{ product.description }}</p>
                        <p>{{ translations['price'] }}: â‚¸{{ product.price }}</p>
                        <p>{{ translations['category'] }}: {{ product.category }}</p>
                    </div>
                </div>
            {% else %}
                <p>{{ translations['no_products'] }}</p>
            {% endfor %}
        </div>
    </section>

</main>


<!-- Search Sidebar -->
<div id="search-sidebar" class="search-sidebar">
    <button class="close-sidebar-btn" id="close-search-sidebar">X</button>
    <h2>{{ translations['search'] }}</h2>
    <form id="search-form" action="/search" method="get">
        <input type="text" id="query-input" name="query" placeholder="Search products..." required>
        <button type="button" id="keyboard-btn">{{ translations['open_keyboard'] }}</button>
        <label>
            <select name="category">
                <option value="">{{ translations['all_categories'] }}</option>
                {% for cat in categories %}
                    <option value="{{ cat }}">{{ cat|capitalize }}</option>
                {% endfor %}
            </select>
        </label>

        <label>
            <select name="price_range">
                <option value="">{{ translations['all_prices'] }}</option>
                <option value="low">{{ translations['low_price'] }}</option>
                <option value="medium">{{ translations['medium_price'] }}</option>
                <option value="high">{{ translations['high_price'] }}</option>
            </select>
        </label>
        <button type="submit" id="submit-search">{{ translations['search_button'] }}</button>
    </form>
</div>

<!-- Keyboard Container -->
<div id="keyboard-container" class="onscreen-keyboard">
    <div class="keyboard-overlay" onclick="closeKeyboard()"></div>
    <div class="keyboard-content">
        <button type="button" id="close-keyboard" onclick="closeKeyboard()">X</button>
        <div id="keyboard"><!-- Keys generated by JS --></div>
    </div>
</div>
<!-- Chat Block in the bottom-right corner -->
<div id="chat-block" class="chat-block chat-open">
    <!-- Header with toggle button -->
    <div class="chat-header">
        <button id="chat-toggle-btn" class="chat-toggle-btn">^</button>
        <span class="chat-title">Chat</span>
    </div>
    <!-- Chat content area -->
    <div class="chat-content">
        {% with chat_history=chat_history %}
    {% include 'chat.html' %}
{% endwith %}
    </div>
</div>


{% endblock %}
